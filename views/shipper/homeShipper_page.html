<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MuaRight - Trang Chủ Shipper</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="../../public/CSS/shipper/homeShipper.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        .navbar-custom {
            background-color: #000; /* Nền đen */
        }
        .text-brown-gold {
            color: #CD7F32 !important; /* Màu vàng đồng/nâu cho thương hiệu */
        }
        .text-white {
            color: white !important;
        }
    </style>
    <link rel="stylesheet" href="../../public/CSS/shipper/profile.css">
</head>
<body>

   <nav class="navbar navbar-expand-lg navbar-dark navbar-custom">
        <div class="container-fluid mx-5">
            <a class="navbar-brand fw-bold text-brown-gold" href="./homeShipper_page.html">MuaRight-shipper</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" href="./homeShipper_page.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link " href="./products_page.html">Products</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link " aria-current="page" href="./profile_Page.html">Profile</a>
                    </li>
                </ul>
                <div class="d-flex align-items-center">
                    
                    <!-- VỊ TRÍ 1: ICON PHƯƠNG TIỆN (Load động) -->
                    <div id="vehicle-icon-nav" class="me-3">
                        <i class="bi bi-truck-front-fill text-info" style="font-size: 1.5rem;"></i>
                    </div>

                    <img src="../../img/image 11.png" alt="Avatar" width="30" height="30" class="me-2 rounded-circle" id="nav-shipper-avatar">
                    <span class="navbar-text text-white me-3" id="nav-shipper-name">
                        Hi, Tom
                    </span>
                    
                    <!-- NÚT ĐĂNG XUẤT -->
                    <button class="btn btn-sm btn-outline-danger" id="logout-btn">
                        <i class="bi bi-box-arrow-right me-1"></i> Đăng xuất
                    </button>
                </div>
            </div>
        </div>
    </nav>
    <main class="container-fluid py-5" style="background-color: black; color: white;">
        
        <div class="row mb-5">
            <div class="col-12 text-center">
                <h1 class="display-5 fw-bold section-header">
                    Giao hương thơm 
                    <img src="https://cdn-icons-png.flaticon.com/128/539/539518.png" alt="Perfume Icon" width="30" height="30" class="mx-2"> 
                    Thu nhập hấp dẫn 
                    <img src="../../public/img/general/money-icon.png" alt="Money Bag Icon" width="30" height="30" class="ms-2">
                </h1>
            </div>
        </div>
        
        <div class="text-center">
            <img src="../../public/img/products/perfume1.png" 
            class="img-fluid rounded shadow-lg" 
            alt="Perfume bottles" 
            style="max-height: 400px; object-fit: cover;">
        </div>


        <div class="row justify-content-center mb-5 gx-4 gy-4">
            <div class="col-lg-5 text-start icon-box p-4" style="background-color: #111; border-radius: 8px;">
                <img src="https://cdn-icons-png.flaticon.com/128/15483/15483380.png" alt="Wallet Icon" width="30" height="30" class="float-start me-2" style="filter: invert(1);"> 
                <p class="fw-bold fs-5"><span class="text-brown-gold">1. Thu Nhập Cạnh Tranh & Ổn Định:</span> Đảm bảo mức thu nhập ổn định mỗi tháng. Khác biệt với các nền tảng khác, bạn hoạt động theo lịch trình nhận hàng và đặt hàng cố định.</p>
            </div>
            <div class="col-lg-5 text-start icon-box p-4" style="background-color: #111; border-radius: 8px;">
                <p class="fw-bold fs-5"><span class="text-brown-gold">2. Chủ Động về Thời Gian:</span> Bạn là ông chủ của lịch trình mình. Tự do quyết định nhận đơn, bắt đầu giao hàng và kết thúc khi nào bạn muốn, không bắt buộc giờ cố định. 
                    <img src="https://cdn-icons-png.flaticon.com/128/850/850960.png" alt="Time Icon" width="30" height="30" class="float-end" style="filter: invert(1);">
                </p>
            </div>
            <div class="col-lg-5 text-start icon-box p-4" style="background-color: #111; border-radius: 8px;">
                <p class="fw-bold fs-5">
                    <img src="https://cdn-icons-png.flaticon.com/128/2789/2789129.png" alt="Diamond Icon" width="30" height="30" class="float-start me-2" style="filter: invert(1);"> 
                    <span class="text-brown-gold">3. Giao Trọn Sự Sang Trọng:</span> Khác biệt với việc giao hàng thông thường, bạn giao sản phẩm giá trị cao cấp, được đóng gói hoàn hảo. Giao hàng nhẹ nhàng, chuyên nghiệp và ít rủi ro hư hỏng.
                </p>
            </div>
            <div class="col-lg-5 text-start icon-box p-4" style="background-color: #111; border-radius: 8px;">
                <p class="fw-bold fs-5"><span class="text-brown-gold">4. Đội Ngũ Hỗ Trợ Tận Tâm 24/7:</span> Không bao giờ giao hàng một mình. Đội ngũ CSKH chuyên nghiệp luôn hỗ trợ bạn xử lý mọi vấn đề phát sinh, đảm bảo mọi chuyến nguy nga đều trọn vẹn. 
                    <img src="https://cdn-icons-png.flaticon.com/128/1017/1017468.png" alt="Headset Icon" width="30" height="30" class="float-end" style="filter: invert(1);">
                </p>
            </div>
        </div>

        <div class="row mb-5 align-items-center">
            <div class="col-lg-6 text-center mb-4 mb-lg-0">
                <img src="../../public/img/products/SP2.jpg" class="img-fluid rounded" alt="Perfume with Lemon Slice" style="max-height: 350px; object-fit: cover;">
            </div>
            <div class="col-lg-6 text-start">
                <h3 class="text-brown-gold mb-4 fw-bold">QUY TRÌNH LÀM VIỆC VÔ CÙNG ĐƠN GIẢN</h3>
                <p class="fs-5">**BƯỚC 1:** <span class="fw-bold text-white">Nhận đơn</span></p>
                <p class="fs-5">**BƯỚC 2:** <span class="fw-bold text-white">Lấy hàng</span></p>
                <p class="fs-5">**BƯỚC 3:** <span class="fw-bold text-white">Giao hàng</span></p>
                <p class="fs-5">**BƯỚC 4:** <span class="fw-bold text-white">Thanh toán</span></p>
            </div>
        </div>

        <div class="row justify-content-center align-items-center mb-5 py-3">
            <div class="col-12">
                <div class="d-flex justify-content-center align-items-center">
                    <img src="https://cdn-icons-png.flaticon.com/128/1865/1865269.png" alt="Location Icon" class="process-icon" width="60" height="60">
                    <img src="https://cdn-icons-png.flaticon.com/128/10233/10233443.png" alt="Arrow" class="arrow-icon mx-3" width="80">
                    <img src="https://cdn-icons-png.flaticon.com/128/17209/17209039.png" alt="Package Icon" class="process-icon" width="60" height="60">
                    <img src="https://cdn-icons-png.flaticon.com/128/10233/10233443.png" alt="Arrow" class="arrow-icon mx-3" width="80">
                    <img src="https://cdn-icons-png.flaticon.com/128/10351/10351751.png" alt="Shipper Icon" class="process-icon" width="60" height="60">
                    <img src="https://cdn-icons-png.flaticon.com/128/10233/10233443.png" alt="Arrow" class="arrow-icon mx-3" width="80">
                    <img src="https://cdn-icons-png.flaticon.com/128/2059/2059129.png" alt="Payment Icon" class="process-icon" width="60" height="60">
                </div>
            </div>
        </div>

        <div class="row justify-content-center mb-5">
            <div class="col-12 text-center share-on">
                <p class="text-white fs-5 fw-bold">Share On</p>
                <a href="#" class="btn btn-outline-light mx-1"><i class="fab fa-twitter"></i></a>
                <a href="#" class="btn btn-outline-light mx-1"><i class="fab fa-facebook-f"></i></a>
                <a href="#" class="btn btn-outline-light mx-1"><i class="fab fa-linkedin-in"></i></a>
            </div>
        </div>

    </main>
    <footer class="footer-custom py-5" style="background-color: #111; color: #aaa;">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-4 mb-md-0">
                    <h5 class="fw-bold text-white">MuaRight</h5>
                    <p>MuaRight là địa chỉ chuyên cung cấp các loại nước hoa chính hãng với chất lượng đảm bảo và giá cả hợp lý.</p>
                    <div class="d-flex social-icons mt-3">
                        <a href="#" class="me-3"><i class="fab fa-twitter fa-2x" style="color: #1DA1F2;"></i></a>
                        <a href="#" class="me-3"><i class="fab fa-facebook-f fa-2x" style="color: #4267B2;"></i></a>
                        <a href="#" class="me-3"><i class="fab fa-linkedin-in fa-2x" style="color: #0077B5;"></i></a>
                        <a href="#" class="me-3"><i class="fab fa-instagram fa-2x" style="color: #C13584;"></i></a>
                    </div>
                </div>
                
                <div class="col-md-3 mb-4 mb-md-0">
                    <h5 class="fw-bold text-white">Liên hệ</h5>
                    <ul class="list-unstyled">
                        <li class="mb-2"><i class="fas fa-map-marker-alt me-2 text-brown-gold"></i> 280 An Dương Vương, P.8, Quận 5, TP.HCM</li>
                        <li class="mb-2"><i class="fas fa-phone me-2 text-brown-gold"></i> 0123 123 123</li>
                        <li class="mb-2"><i class="fas fa-envelope me-2 text-brown-gold"></i> MuaRightshop@gmail.com</li>
                    </ul>
                </div>
                
                <div class="col-md-3 mb-4 mb-md-0">
                    <h5 class="fw-bold text-white">Chính sách</h5>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="#" style="color: inherit; text-decoration: none;">Chính sách đổi trả</a></li>
                        <li class="mb-2"><a href="#" style="color: inherit; text-decoration: none;">Chính sách bảo mật</a></li>
                        <li class="mb-2"><a href="#" style="color: inherit; text-decoration: none;">Chính sách vận chuyển</a></li>
                    </ul>
                </div>
                
                <div class="col-md-2">
                    <h5 class="fw-bold text-white">Thanh toán</h5>
                    <ul class="list-unstyled">
                        <li class="mb-2"><img src="https://cdn-icons-png.flaticon.com/128/2059/2059129.png" alt="Payment Icon" width="18" class="me-2" style="filter: invert(1);"> Thanh toán khi nhận hàng</li>
                        <li class="mb-2"><img src="https://blog.pay2s.vn/wp-content/uploads/2024/11/momo_icon_circle_pinkbg_RGB-300x300.png" alt="Momo Icon" width="18" class="me-2" style="filter: invert(1);"> Ví điện tử Momo</li>
                        <li class="mb-2"><i class="fab fa-cc-visa me-2 text-primary"></i> Thẻ Visa</li>
                        <li class="mb-2"><i class="fab fa-cc-paypal me-2 text-info"></i> Paypal</li>
                    </ul>
                </div>
            </div>
            
            <div class="row mt-4 pt-3 border-top border-secondary">
                <div class="col-12 text-center">
                    <p class="mb-0">© 2025 MuaRight Inc. All rights reserved</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
            // ✅ 1. ĐỊNH NGHĨA HẰNG SỐ (GLOBAL SCOPE)
            const API_BASE = 'http://localhost:3000/api/shipper'; 
            // Giả định tên file đăng nhập là chữ thường để khắc phục lỗi chuyển hướng
            const LOGOUT_REDIRECT_URL = '../../template/pages/signin_page.html'; 
            
            // ✅ 2. CÁC HÀM HELPER VÀ LOGIC
            
            // HÀM GET SHIPPER ID (Kiểm tra và chuyển hướng nếu không có)
            function getShipperId() {
                const raw = localStorage.getItem('account');
                if (!raw) {
                    location.href = LOGOUT_REDIRECT_URL; 
                    return null;
                }
                try {
                    const acc = JSON.parse(raw);
                    const id = Number(acc?.AccountId ?? acc?.ShipperId); 
                    return Number.isFinite(id) && id > 0 ? id : null;
                } catch { 
                    location.href = LOGOUT_REDIRECT_URL;
                    return null;
                }
            }

            // HÀM XÁC ĐỊNH ICON PHƯƠNG TIỆN
            function vehicleIconClass(v) {
                const s = (v || '').toLowerCase();
                if (s.includes('ô tô') || s.includes('car')) return 'bi bi-car-front-fill text-danger';
                if (s.includes('tải') || s.includes('truck')) return 'bi bi-truck-front-fill text-warning';
                return 'bi bi-motorcycle text-info'; 
            }

            // HÀM GỌI API LẤY PROFILE
            async function httpGetProfile(id) { // Nhận ID từ bên ngoài
                const res = await fetch(`${API_BASE}/profile/${id}`);
                const json = await res.json();
                if (!res.ok || !json?.success) throw new Error(json?.message || res.statusText);
                return json.profile;
            }

            // HÀM RENDER PROFILE LÊN HEADER
            function renderHeader(p) {
                const navName = document.getElementById('nav-shipper-name');
                const navAvatar = document.getElementById('nav-shipper-avatar');
                const vehicleIcon = document.getElementById('vehicle-icon-nav');
                
                if (navName) navName.textContent = `Hi, ${p.FullName || p.Username || '—'}`;
                if (navAvatar) navAvatar.src = p.ImageUrl || '../../img/image 11.png';
                
                // Cập nhật ICON PHƯƠNG TIỆN
                if (vehicleIcon) vehicleIcon.innerHTML = `<i class="${vehicleIconClass(p.VehicleInfo)}" style="font-size:1.5rem"></i>`;
            }

            // LOGIC ĐĂNG XUẤT
            function setupLogout() {
                const btnLogout = document.getElementById('logout-btn');
                if (btnLogout) {
                    btnLogout.addEventListener('click', async () => {
                        fetch(`${API_BASE}/logout`, { method: 'POST' }).catch(() => {});
                        
                        localStorage.removeItem('account');
                        ['shipperToken','shipperId','shipperUsername','shipperFullName','shipperEmail','shipperAvatar']
                            .forEach(k => localStorage.removeItem(k));
                        
                        // Sửa lỗi chuyển hướng bằng đường dẫn tuyệt đối (hoặc đường dẫn đã sửa)
                        window.location.replace(LOGOUT_REDIRECT_URL); 
                    });
                }
            }

            // ✅ 3. CHẠY LOGIC CHÍNH KHI TRANG ĐÃ TẢI XONG
            document.addEventListener('DOMContentLoaded', async () => {
                const shipperId = getShipperId();
                
                // Nếu getShipperId đã chuyển hướng (trả về null), thì dừng
                if (!shipperId) return; 

                try {
                    const profile = await httpGetProfile(shipperId);
                    renderHeader(profile);
                    setupLogout();
                } catch (e) {
                    console.error('Lỗi tải header/profile:', e);
                    // Nếu API lỗi, header sẽ hiển thị thông tin mặc định
                }
            });

</script>
</body>
</html>
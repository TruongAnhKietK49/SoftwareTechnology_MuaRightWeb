<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MuaRight ‚Äì Blog</title>

    <!-- Bootstrap & Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../../public/CSS/user/blogPage.css">
</head>

<body>

    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top mr-nav">
        <div class="container">
            <a class="navbar-brand brand-xl" href="../../index.html">MuaRight</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mrNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="mrNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="../../index.html">Trang ch·ªß</a></li>
                    <li class="nav-item"><a class="nav-link" href="./Product_Page.html">Shop</a></li>
                    <li class="nav-item"><a class="nav-link active" href="./Blog_Page.html">Blog</a></li>
                    <li class="nav-item"><a class="nav-link" href="../../template/pages/signIn_page.html"><i
                                class="bi bi-person"></i></a></li>
                </ul>
            </div>
        </div>
    </nav>

    <main>
        <div class="section-head">
            <h4>üìù Blog N∆∞·ªõc Hoa</h4>
            <div class="small muted">C√¢u chuy·ªán ‚Äì L·ªãch s·ª≠ ‚Äì Ngh·ªá thu·∫≠t h∆∞∆°ng th∆°m</div>
        </div>

        <!-- L∆∞·ªõi b√†i vi·∫øt -->
        <div id="grid" class="grid row g-4 px-3 px-md-0"></div>

        <!-- Pagination -->
        <nav class="pager">
            <ul id="blogPagination" class="pagination"></ul>
        </nav>
    </main>

    <!-- MODAL CHI TI·∫æT B√ÄI VI·∫æT -->
    <div class="modal fade" id="postModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 id="pmTitle" class="modal-title"></h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row g-4">
                        <div class="col-lg-5">
                            <img id="pmImage" class="post-img" alt="">
                        </div>
                        <div class="col-lg-7">
                            <div class="d-flex align-items-center gap-2 mb-2">
                                <button id="pmLike" class="btn like-btn btn-sm"><i class="bi bi-heart"></i> <span
                                        id="pmLikeTxt">Y√™u th√≠ch</span></button>
                                <span class="small text-secondary">‚Ä¢</span>
                                <span class="small text-secondary">L∆∞·ª£t tym: <span id="pmLikeCount">0</span></span>
                            </div>
                            <div id="pmContent" class="mb-3"></div>

                            <h6 class="mt-3 mb-2">B√¨nh lu·∫≠n</h6>
                            <div id="cmtList" class="mb-3"></div>
                            <form id="cmtForm" class="row g-2">
                                <div class="col-sm-5"><input id="cmtName" class="form-control"
                                        placeholder="T√™n c·ªßa b·∫°n"></div>
                                <div class="col-12"><textarea id="cmtText" class="form-control" rows="2"
                                        placeholder="Vi·∫øt b√¨nh lu·∫≠n..."></textarea></div>
                                <div class="col-12 d-flex gap-2"><button class="btn btn-gold" type="submit"><i
                                            class="bi bi-send me-1"></i>G·ª≠i</button>
                                    <div id="cmtToast" class="small text-success" style="display:none">ƒê√£ g·ª≠i! ‚úÖ</div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <small class="text-secondary">MuaRight ‚Ä¢ Blog h∆∞∆°ng th∆°m</small>
                </div>
            </div>
        </div>
    </div>

    <!-- N√öT T·∫†O B√ÄI VI·∫æT -->
    <button id="btnNewPost" class="btn btn-gold position-fixed rounded-circle"
        style="right:24px; bottom:24px; width:56px; height:56px; z-index:1050;">
        <i class="bi bi-plus-lg fs-4"></i>
    </button>

    <!-- MODAL T·∫†O B√ÄI VI·∫æT -->
    <div class="modal fade" id="newPostModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">‚úçÔ∏è T·∫°o b√†i vi·∫øt m·ªõi</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <form id="newPostForm">
                    <div class="modal-body">
                        <div class="row g-3">
                            <div class="col-md-8">
                                <label class="form-label small">Ti√™u ƒë·ªÅ *</label>
                                <input id="npTitle" class="form-control"
                                    placeholder="VD: H√†nh tr√¨nh n∆∞·ªõc hoa t·ª´ Ai C·∫≠p ƒë·∫øn Grasse" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label small">Ch·ªß ƒë·ªÅ</label>
                                <input id="npCategory" class="form-control" placeholder="Ch·ªß ƒë·ªÅ">
                            </div>
                            <div class="col-12">
                                <label class="form-label small">M√¥ t·∫£ ng·∫Øn</label>
                                <input id="npSubtitle" class="form-control" placeholder="1‚Äì2 c√¢u m√¥ t·∫£ t√≥m t·∫Øt">
                            </div>
                            <div class="col-12">
                                <label class="form-label small">·∫¢nh cover (URL)</label>
                                <input id="npCover" class="form-control" placeholder="https://.../cover.jpg">
                                <div class="small text-secondary mt-1">N·∫øu ƒë·ªÉ tr·ªëng ho·∫∑c l·ªói, h·ªá th·ªëng s·∫Ω d√πng ·∫£nh d·ª±
                                    ph√≤ng.</div>
                            </div>
                            <div class="col-12">
                                <label class="form-label small">N·ªôi dung *</label>
                                <textarea id="npContent" class="form-control" rows="6"
                                    placeholder="N·ªôi dung b√†i vi·∫øt..." required></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <small class="text-secondary me-auto">L∆∞u localStorage ‚Ä¢ C√≥ th·ªÉ n·ªëi API sau.</small>
                        <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">H·ªßy</button>
                        <button type="submit" class="btn btn-gold">L∆∞u b√†i</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- FOOTER CONTAINER -->
    <div id="footer-container"></div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        /* ----------------- DATA G·ªêC ----------------- */
        const DEFAULT_POSTS = [
            {
                id: 'gardenia-harmony', title: 'üíú B·∫£n h√≤a ca d·ªãu √™m c·ªßa h∆∞∆°ng o·∫£i h∆∞∆°ng', img: 'h√¨nh%20·∫£nh/13.jpg',
                excerpt: 'O·∫£i h∆∞∆°ng ‚Äì bi·ªÉu t∆∞·ª£ng th∆∞ gi√£n v√† thu·∫ßn khi·∫øt trong th·∫ø gi·ªõi h∆∞∆°ng th∆°m.',
                content: `T·ª´ nh·ªØng c√°nh ƒë·ªìng t√≠m bi·∫øc ·ªü Provence (Ph√°p), o·∫£i h∆∞∆°ng l√† nguy√™n li·ªáu bi·ªÉu t∆∞·ª£ng c·ªßa ng√†nh ƒëi·ªÅu h∆∞∆°ng.
H∆∞∆°ng ƒë·∫ßu t∆∞∆°i m√°t, ƒëi·ªÉm ch√∫t th·∫£o m·ªôc; h∆∞∆°ng gi·ªØa √™m ƒë·ªÅm; h∆∞∆°ng cu·ªëi v∆∞∆°ng v·∫•n t·ª± nhi√™n ‚Äì r·∫•t d·ªÖ d√πng h·∫±ng ng√†y.`},
            {
                id: 'art-of-selection', title: 'üå∏ Ngh·ªá thu·∫≠t tuy·ªÉn ch·ªçn n∆∞·ªõc hoa cao c·∫•p', img: 'h√¨nh%20·∫£nh/4.jpg',
                excerpt: 'M·ªói m√πi h∆∞∆°ng l√† m·ªôt h√†nh tr√¨nh c·∫£m x√∫c ‚Äì k·∫øt tinh c·ªßa nguy√™n li·ªáu tinh tuy·ªÉn.',
                content: `Ch·ªçn m√πi ƒë√∫ng b·∫Øt ƒë·∫ßu t·ª´ b·ªëi c·∫£nh s·ª≠ d·ª•ng v√† c√° t√≠nh. H√£y th·ª≠ tr√™n da t·ªëi thi·ªÉu 30‚Äì60 ph√∫t ƒë·ªÉ c·∫£m nh·∫≠n h∆∞∆°ng ƒë·∫ßu ‚Äì gi·ªØa ‚Äì cu·ªëi chuy·ªÉn m√¨nh.`
            },
            {
                id: 'rose-timeless', title: 'üåπ V·∫ª ƒë·∫πp v∆∞·ª£t th·ªùi gian c·ªßa n∆∞·ªõc hoa h·ªìng', img: 'h√¨nh%20·∫£nh/16.jpg',
                excerpt: 'Hoa h·ªìng ‚Äì ‚Äún·ªØ ho√†ng‚Äù c·ªßa m√πi h∆∞∆°ng ‚Äì t·ª´ t∆∞∆°i s√°ng ƒë·∫øn sang tr·ªçng.',
                content: `Nguy√™n li·ªáu hoa h·ªìng t·ª´ Grasse ƒë·∫øn Th·ªï Nhƒ© K·ª≥ t·∫°o n√™n d·∫£i s·∫Øc th√°i r·ªông. K·∫øt h·ª£p c√πng g·ªó/x·∫°/h·ªï ph√°ch gi√∫p m√πi s√¢u v√† quy·∫øn r≈©.`
            },
            {
                id: 'heritage-fragrance', title: 'üèõÔ∏è T·ª´ Ai C·∫≠p ƒë·∫øn Grasse: di s·∫£n n∆∞·ªõc hoa', img: 'h√¨nh%20·∫£nh/1.jpg',
                excerpt: 'T·ª´ nghi l·ªÖ c·ªï ƒë·∫°i ƒë·∫øn ngh·ªá thu·∫≠t s·ªëng ch√¢u √Çu.',
                content: `Ai C·∫≠p d√πng nh·ª±a th∆°m cho nghi l·ªÖ; La M√£ ƒë∆∞a h∆∞∆°ng l√™n ƒë·ªânh xa x·ªâ; Grasse tr·ªü th√†nh th·ªß ph·ªß nh·ªù kh√≠ h·∫≠u & k·ªπ ngh·ªá ch∆∞ng c·∫•t.`
            },
            {
                id: 'house-signature', title: 'üè∑Ô∏è ‚ÄúD·∫•u ·∫•n nh√† m·ªët‚Äù: ch·ªØ k√Ω h∆∞∆°ng', img: 'h√¨nh%20·∫£nh/25.jpg',
                excerpt: 'M·ªói th∆∞∆°ng hi·ªáu nu√¥i d∆∞·ª°ng DNA m√πi h∆∞∆°ng ri√™ng.',
                content: `‚ÄúCh·ªØ k√Ω h∆∞∆°ng‚Äù gi√∫p b·∫°n nh·∫≠n di·ªán b·∫£n s·∫Øc th∆∞∆°ng hi·ªáu v√† t√¨m l·ª±a ch·ªçn h·ª£p c√° t√≠nh, phong c√°ch trang ph·ª•c.`
            },
            {
                id: 'raw-materials', title: 'üåø Nguy√™n li·ªáu ‚Äì tr√°i tim c·ªßa m√πi h∆∞∆°ng', img: 'h√¨nh%20·∫£nh/21.jpg',
                excerpt: 'T·ª± nhi√™n g·∫∑p g·ª° c√¥ng ngh·ªá ƒë·ªÉ m·ªü r·ªông s√°ng t·∫°o.',
                content: `Ch·∫•t l∆∞·ª£ng nguy√™n li·ªáu quy·∫øt ƒë·ªãnh ƒë·ªô s√¢u. Ph√¢n t·ª≠ t·ªïng h·ª£p an to√†n t√°i hi·ªán c√°c n·ªët kh√≥ chi·∫øt xu·∫•t, b·ªÅn v·ªØng h∆°n cho m√¥i tr∆∞·ªùng.`
            },
            {
                id: 'men-perfume-guide', title: 'üß≠ C·∫©m nang ch·ªçn n∆∞·ªõc hoa nam', img: 'h√¨nh%20·∫£nh/20.jpg',
                excerpt: 'T·ª´ citrus ‚Äì g·ªó s·∫°ch ƒë·∫øn gia v·ªã ·∫•m √°p.',
                content: `VƒÉn ph√≤ng ∆∞u ti√™n s·∫°ch, s√°ng; ƒëi ch∆°i c√≥ th·ªÉ c√° t√≠nh h∆°n. Ch·ªçn m√πi khi·∫øn b·∫°n th·∫•y t·ª± tin, tho·∫£i m√°i su·ªët ng√†y d√†i.`
            },
            {
                id: 'layering-tips', title: 'üß© Layering ‚Äì pha tr·ªôn h∆∞∆°ng nh∆∞ perfumer', img: 'h√¨nh%20·∫£nh/24.jpg',
                excerpt: 'Ph·ªëi c√°c m√πi t∆∞∆°ng th√≠ch ƒë·ªÉ ra b·∫£n ph·ªëi c·ªßa ri√™ng b·∫°n.',
                content: `B·∫Øt ƒë·∫ßu l·ªõp n·ªÅn nh·∫π, th√™m ƒëi·ªÉm nh·∫•n sau. C·∫∑p d·ªÖ ch·ªãu: vani‚Äìg·ªó, citrus‚Äìtr√†, hoa tr·∫Øng‚Äìx·∫°. Th·ª≠ t·ª´ng ch√∫t ƒë·ªÉ tr√°nh qu√° tay.`
            },
            {
                id: 'storage-care', title: 'üì¶ B·∫£o qu·∫£n n∆∞·ªõc hoa ƒë√∫ng c√°ch', img: 'h√¨nh%20·∫£nh/10.jpg',
                excerpt: 'Nhi·ªát, √°nh s√°ng, ·∫©m l√† k·∫ª th√π c·ªßa m√πi.',
                content: `ƒê·ªÉ n∆°i kh√¥ m√°t, tr√°nh n·∫Øng tr·ª±c ti·∫øp, ƒë·∫≠y k√≠n n·∫Øp. M·ªôt s·ªë chai n√™n c·∫•t trong h·ªôp t·ªëi m√†u ƒë·ªÉ k√©o d√†i tu·ªïi th·ªç.`
            },
            {
                id: 'scent-and-memory', title: 'üß† M√πi h∆∞∆°ng & k√Ω ·ª©c', img: 'h√¨nh%20·∫£nh/23.jpg',
                excerpt: 'Kh·ª©u gi√°c k·∫øt n·ªëi th·∫≥ng v√πng c·∫£m x√∫c ‚Äì v√¨ th·∫ø h∆∞∆°ng ‚Äúch·∫°m‚Äù k√Ω ·ª©c r·∫•t nhanh.',
                content: `M√πi quen c√≥ th·ªÉ ƒë∆∞a ta v·ªÅ kho·∫£nh kh·∫Øc xa. Khi ch·ªçn n∆∞·ªõc hoa, b·∫°n c≈©ng ch·ªçn c√¢u chuy·ªán mu·ªën ghi d·∫•u cho ch√≠nh m√¨nh.`
            },
        ];

        /* ----------------- localStorage helpers ----------------- */
        const CUSTOM_KEY = 'blogs_custom';
        const likeKey = id => `blog_like_${id}`;
        const cmtKey = id => `blog_cmts_${id}`;

        function loadCustom() { try { return JSON.parse(localStorage.getItem(CUSTOM_KEY) || '[]'); } catch (e) { return []; } }
        function saveCustom(arr) { localStorage.setItem(CUSTOM_KEY, JSON.stringify(arr)); }
        const getLikes = id => Number(localStorage.getItem(likeKey(id)) || '0');
        const setLikes = (id, n) => localStorage.setItem(likeKey(id), String(n));
        const getCmts = id => { try { return JSON.parse(localStorage.getItem(cmtKey(id)) || '[]') } catch (e) { return [] } };
        const addCmt = (id, cmt) => { const arr = getCmts(id); arr.push(cmt); localStorage.setItem(cmtKey(id), JSON.stringify(arr)); };

        /* ----------------- State & Pagination ----------------- */
        const PER_PAGE = 6;
        function stateFromURL() {
            const params = new URLSearchParams(location.search);
            return { page: Math.max(1, parseInt(params.get('page') || '1', 10)) };
        }
        function pushState(st) {
            const p = new URLSearchParams();
            if (st.page > 1) p.set('page', String(st.page));
            history.replaceState(null, '', '?' + p.toString());
        }

        /* ----------------- Merge posts ----------------- */
        function allPosts() {
            return [...loadCustom(), ...DEFAULT_POSTS]; // b√†i m·ªõi t·∫°o l√™n tr∆∞·ªõc
        }

        /* ----------------- Render grid + pager ----------------- */
        function renderGrid() {
            const grid = document.getElementById('grid');
            const pager = document.getElementById('blogPagination');

            const posts = allPosts();
            const st = stateFromURL();
            const totalPages = Math.max(1, Math.ceil(posts.length / PER_PAGE));
            const page = Math.min(st.page, totalPages);
            if (page !== st.page) { st.page = page; pushState(st); }

            const start = (page - 1) * PER_PAGE, end = start + PER_PAGE;
            const pageItems = posts.slice(start, end);

            grid.innerHTML = pageItems.map(p => `
    <div class="col-12 col-md-6 col-lg-4">
      <div class="product-card h-100 d-flex flex-column">
        <img class="product-thumb" src="${p.img || p.cover || ''}" alt="${p.title}"
             onerror="this.onerror=null;this.src='https://picsum.photos/640/400?blur=2'">
        <div class="card-overlay">
          <button class="btn btn-sm btn-outline-light pill" data-view="${p.id}">
            ƒê·ªçc b√†i vi·∫øt <i class="bi bi-arrow-right"></i>
          </button>
        </div>
        <div class="p-3 p-md-4 d-flex flex-column">
          <div class="d-flex justify-content-between small mb-1">
            <span class="badge rounded-pill badge-tag">${p.category || 'Ch·ªß ƒë·ªÅ'}</span>
            <span class="small-muted"><i class="bi bi-heart-fill text-danger"></i> ${getLikes(p.id)}</span>
          </div>
          <div class="product-title">${p.title}</div>
          <div class="small small-muted flex-grow-1">${p.excerpt || p.subtitle || ''}</div>
          <div class="mt-3 d-flex justify-content-between align-items-center">
            <button class="btn btn-outline-gold btn-sm" data-view="${p.id}">Read More</button>
          </div>
        </div>
      </div>
    </div>
  `).join('');

            // pager
            let html = '';
            const add = (p, txt, disabled = false, active = false) => {
                html += `<li class="page-item ${disabled ? 'disabled' : ''} ${active ? 'active' : ''}">
               <a class="page-link" href="#" data-page="${p}">${txt}</a>
             </li>`;
            };
            add(page - 1, '&laquo;', page === 1);
            for (let i = 1; i <= totalPages; i++) add(i, i, false, i === page);
            add(page + 1, '&raquo;', page === totalPages);
            pager.innerHTML = html;
        }

        /* ----------------- Modal ƒë·ªçc b√†i ----------------- */
        const modalEl = document.getElementById('postModal');
        const bsModal = new bootstrap.Modal(modalEl);

        const pmTitle = document.getElementById('pmTitle');
        const pmImage = document.getElementById('pmImage');
        const pmContent = document.getElementById('pmContent');
        const pmLikeBtn = document.getElementById('pmLike');
        const pmLikeTxt = document.getElementById('pmLikeTxt');
        const pmLikeCount = document.getElementById('pmLikeCount');
        const cmtList = document.getElementById('cmtList');
        const cmtForm = document.getElementById('cmtForm');
        const cmtName = document.getElementById('cmtName');
        const cmtText = document.getElementById('cmtText');
        const cmtToast = document.getElementById('cmtToast');

        let currentPostId = '';

        function escapeHTML(s) { return String(s).replace(/[&<>"']/g, m => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[m])); }

        function openPost(id) {
            const p = allPosts().find(x => x.id === id); if (!p) return;
            currentPostId = id;

            pmTitle.textContent = p.title;
            pmImage.src = p.img || p.cover || '';
            pmImage.alt = p.title;
            pmImage.onerror = () => { pmImage.onerror = null; pmImage.src = 'https://picsum.photos/640/400?blur=2'; };

            // Render n·ªôi dung (ƒëo·∫°n -> <p>)
            const content = p.content || '';
            pmContent.innerHTML = content.split('\n').map(s => s.trim()).filter(Boolean)
                .map(s => `<p class="mb-2">${escapeHTML(s)}</p>`).join('');

            const likes = getLikes(id);
            pmLikeCount.textContent = likes;
            pmLikeBtn.classList.remove('liked');
            pmLikeTxt.textContent = 'Y√™u th√≠ch';

            renderComments();
            bsModal.show();
        }

        function renderComments() {
            const arr = getCmts(currentPostId);
            if (!arr.length) {
                cmtList.innerHTML = `<div class="text-secondary small">Ch∆∞a c√≥ b√¨nh lu·∫≠n. H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n!</div>`;
                return;
            }
            cmtList.innerHTML = arr.slice().reverse().map(c => `
    <div class="comment-item">
      <div class="d-flex justify-content-between">
        <div class="fw-semibold">${escapeHTML(c.name || 'Kh√°ch')}</div>
        <div class="small text-secondary">${new Date(c.time).toLocaleString()}</div>
      </div>
      <div class="mt-1">${escapeHTML(c.text || '')}</div>
    </div>
  `).join('');
        }

        /* ----------------- Events ----------------- */
        // m·ªü b√†i
        document.addEventListener('click', (e) => {
            const btnView = e.target.closest('[data-view]');
            if (btnView) {
                e.preventDefault();
                openPost(btnView.getAttribute('data-view'));
            }
        });

        // like
        pmLikeBtn.addEventListener('click', () => {
            if (!currentPostId) return;
            pmLikeBtn.classList.add('liked');
            pmLikeTxt.textContent = 'ƒê√£ th√≠ch';
            const n = getLikes(currentPostId) + 1;
            setLikes(currentPostId, n);
            pmLikeCount.textContent = n;
            renderGrid(); // update s·ªë tym tr√™n th·∫ª & gi·ªØ trang
        });

        // comment
        cmtForm.addEventListener('submit', (e) => {
            e.preventDefault();
            if (!currentPostId) return;
            const name = (cmtName.value || '').trim() || 'Kh√°ch';
            const text = (cmtText.value || '').trim();
            if (!text) return;
            addCmt(currentPostId, { name, text, time: Date.now() });
            cmtText.value = ''; cmtToast.style.display = 'block';
            setTimeout(() => cmtToast.style.display = 'none', 1200);
            renderComments();
        });

        // pager click
        document.getElementById('blogPagination').addEventListener('click', (e) => {
            const a = e.target.closest('a.page-link'); if (!a) return; e.preventDefault();
            const st = stateFromURL();
            const p = parseInt(a.dataset.page, 10);
            if (!isNaN(p)) { st.page = p; pushState(st); renderGrid(); }
        });

        /* ----------------- New Post ----------------- */
        const newPostModal = new bootstrap.Modal(document.getElementById('newPostModal'));
        document.getElementById('btnNewPost').addEventListener('click', () => newPostModal.show());

        document.getElementById('newPostForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const title = document.getElementById('npTitle').value.trim();
            const category = document.getElementById('npCategory').value.trim() || 'Ch·ªß ƒë·ªÅ';
            const subtitle = document.getElementById('npSubtitle').value.trim();
            const cover = document.getElementById('npCover').value.trim();
            const content = document.getElementById('npContent').value.trim();
            if (!title || !content) { alert('Vui l√≤ng nh·∫≠p t·ªëi thi·ªÉu Ti√™u ƒë·ªÅ v√† N·ªôi dung.'); return; }

            const slug = title.toLowerCase()
                .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
                .replace(/[^a-z0-9\s-]/g, '').replace(/\s+/g, '-').replace(/-+/g, '-');
            const id = `${slug}-${Date.now().toString(36)}`;
            const post = { id, category, title, subtitle, cover, content };

            const arr = loadCustom(); arr.unshift(post); saveCustom(arr);
            e.target.reset(); newPostModal.hide();

            // v·ªÅ trang 1 ƒë·ªÉ th·∫•y b√†i m·ªõi
            pushState({ page: 1 }); renderGrid();
            openPost(id);
        });

        /* ----------------- Misc ----------------- */
        function setNavH() {
            const nav = document.querySelector('.navbar');
            if (!nav) return;
            const h = nav.offsetHeight || 72;
            document.documentElement.style.setProperty('--nav-h', h + 'px');
        }
        window.addEventListener('load', () => { setNavH(); renderGrid(); });
        window.addEventListener('resize', setNavH);
        if (document.fonts && document.fonts.ready) { document.fonts.ready.then(setNavH); }

        /* Footer loader */
        document.addEventListener("DOMContentLoaded", async () => {
            const box = document.getElementById("footer-container");
            if (!box) return;
            const paths = [
                "../../template/includes/footer.html",
                "../template/includes/footer.html",
                "template/includes/footer.html",
                "partials/footer.html",
                "footer.html"
            ];
            for (const p of paths) {
                try {
                    const res = await fetch(p, { cache: "no-cache" });
                    if (res.ok) {
                        const html = await res.text();
                        box.innerHTML = html;
                        const yearEl = box.querySelector("#mr-year");
                        if (yearEl) yearEl.textContent = new Date().getFullYear();
                        return;
                    }
                } catch (e) { }
            }
            console.error("‚ùå Kh√¥ng t·∫£i ƒë∆∞·ª£c footer t·ª´ c√°c ƒë∆∞·ªùng d·∫´n:", paths);
        });
    </script>
</body>

</html>